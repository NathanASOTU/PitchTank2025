<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pitch Tank Competition</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.9/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDRwVHh0r-hpb1Wfa6YdSj4cZRWx9Wl0pM",
      authDomain: "asotu-con-pitch-tank.firebaseapp.com",
      projectId: "asotu-con-pitch-tank",
      storageBucket: "asotu-con-pitch-tank.firebasestorage.app",
      messagingSenderId: "397957008743",
      appId: "1:397957008743:web:919855d25d5e739fb8f3c2"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Room configurations
    const rooms = {
      studio1: {
        name: "Studio 1",
        judges: [
          { name: "Kyle Mountsier", image: "https://via.placeholder.com/100?text=Kyle" },
          { name: "Beth Hill", image: "https://via.placeholder.com/100?text=Beth" },
          { name: "Christopher Twohig", image: "https://via.placeholder.com/100?text=Christopher" },
          { name: "Chase Fraser", image: "https://via.placeholder.com/100?text=Chase" }
        ],
        companies: [
          { name: "Autoz Network LLC", logo: "https://via.placeholder.com/150?text=Autoz" },
          { name: "Toma", logo: "https://via.placeholder.com/150?text=Toma" },
          { name: "DriveItAway", logo: "https://via.placeholder.com/150?text=DriveItAway" },
          { name: "Free2Move", logo: "https://via.placeholder.com/150?text=Free2Move" }
        ]
      },
      studio2: {
        name: "Studio 2",
        judges: [
          { name: "Michael Cirillo", image: "https://via.placeholder.com/100?text=Michael" },
          { name: "Ben Hadley", image: "https://via.placeholder.com/100?text=Ben" },
          { name: "Patrick Abad", image: "https://via.placeholder.com/100?text=Patrick" },
          { name: "Bill Cariss", image: "https://via.placeholder.com/100?text=Bill" }
        ],
        companies: [
          { name: "Carmen", logo: "https://via.placeholder.com/150?text=Carmen" },
          { name: "Lyteflo", logo: "https://via.placeholder.com/150?text=Lyteflo" },
          { name: "Space Auto", logo: "https://via.placeholder.com/150?text=SpaceAuto" }
        ]
      },
      studio3: {
        name: "Studio 3",
        judges: [
          { name: "Paul J Daly", image: "https://via.placeholder.com/100?text=Paul" },
          { name: "Elizabeth Shults", image: "https://via.placeholder.com/100?text=Elizabeth" },
          { name: "Brian Donnelly", image: "https://via.placeholder.com/100?text=Brian" },
          { name: "Tony Fowler", image: "https://via.placeholder.com/100?text=Tony" }
        ],
        companies: [
          { name: "Fasten Rewards", logo: "https://via.placeholder.com/150?text=Fasten" },
          { name: "Mia", logo: "https://via.placeholder.com/150?text=Mia" },
          { name: "Autograph Analytics", logo: "https://via.placeholder.com/150?text=Autograph" }
        ]
      },
      finals: {
        name: "Finals",
        judges: [
          { name: "Kyle Mountsier", image: "https://via.placeholder.com/100?text=Kyle" },
          { name: "Beth Hill", image: "https://via.placeholder.com/100?text=Beth" },
          { name: "Chase Fraser", image: "https://via.placeholder.com/100?text=Chase" },
          { name: "Bill Cariss", image: "https://via.placeholder.com/100?text=Bill" },
          { name: "Brian Donnelly", image: "https://via.placeholder.com/100?text=Brian" }
        ],
        companies: []
      }
    };

    const App = () => {
      const [selectedRoom, setSelectedRoom] = useState("studio1");
      const [teams, setTeams] = useState(["Team 1", "Team 2", "Team 3"]); // Example teams
      const [scores, setScores] = useState({});
      const [audienceVotes, setAudienceVotes] = useState({});

      // Fetch scores from Firebase
      useEffect(() => {
        const scoresRef = db.ref("scores");
        scoresRef.on("value", (snapshot) => {
          setScores(snapshot.val() || {});
        });
        const votesRef = db.ref("audience_votes");
        votesRef.on("value", (snapshot) => {
          setAudienceVotes(snapshot.val() || {});
        });
        return () => {
          scoresRef.off();
          votesRef.off();
        };
      }, []);

      // Handle judge score submission
      const handleJudgeSubmit = (team, judge, score) => {
        db.ref(`scores/${selectedRoom}/${team}/${judge}`).set(parseInt(score));
      };

      // Handle audience vote submission
      const handleAudienceSubmit = (team, vote) => {
        const voteId = Date.now(); // Unique ID for each vote
        db.ref(`audience_votes/${selectedRoom}/${team}/${voteId}`).set(parseInt(vote));
      };

      // Calculate total score for a team
      const calculateTeamScore = (team) => {
        const judgeScores = scores[selectedRoom]?.[team] || {};
        const judgeTotal = Object.values(judgeScores).reduce((sum, score) => sum + score, 0);
        const audienceScores = audienceVotes[selectedRoom]?.[team] || {};
        const audienceAvg = Object.values(audienceScores).length
          ? Object.values(audienceScores).reduce((sum, vote) => sum + vote, 0) /
            Object.values(audienceScores).length
          : 0;
        return (judgeTotal + audienceAvg).toFixed(2); // Audience weighted as one judge
      };

      return (
        <div className="min-h-screen bg-gray-100 p-6">
          <h1 className="text-3xl font-bold text-center mb-6">Pitch Tank Competition</h1>

          {/* Room Selector */}
          <div className="mb-6 text-center">
            <label className="mr-2">Select Room:</label>
            <select
              className="border rounded p-2"
              value={selectedRoom}
              onChange={(e) => setSelectedRoom(e.target.value)}
            >
              {Object.keys(rooms).map((roomKey) => (
                <option key={roomKey} value={roomKey}>
                  {rooms[roomKey].name}
                </option>
              ))}
            </select>
          </div>

          {/* Judges and Companies */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <h2 className="text-xl font-semibold mb-2">Judges</h2>
              <div className="grid grid-cols-2 gap-4">
                {rooms[selectedRoom].judges.map((judge) => (
                  <div key={judge.name} className="text-center">
                    <img
                      src={judge.image}
                      alt={judge.name}
                      className="w-20 h-20 rounded-full mx-auto mb-2"
                    />
                    <p>{judge.name}</p>
                  </div>
                ))}
              </div>
            </div>
            <div>
              <h2 className="text-xl font-semibold mb-2">Companies</h2>
              <div className="grid grid-cols-2 gap-4">
                {rooms[selectedRoom].companies.map((company) => (
                  <div key={company.name} className="text-center">
                    <img
                      src={company.logo}
                      alt={company.name}
                      className="w-24 h-24 mx-auto mb-2"
                    />
                    <p>{company.name}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Judge Score Input */}
          <div className="mb-6">
            <h2 className="text-xl font-semibold mb-2">Judge Scoring</h2>
            {rooms[selectedRoom].judges.map((judge) => (
              <div key={judge.name} className="mb-4">
                <h3 className="font-medium">{judge.name}</h3>
                {teams.map((team) => (
                  <div key={team} className="flex items-center mb-2">
                    <label className="w-32">{team}:</label>
                    <select
                      className="border rounded p-1"
                      onChange={(e) => handleJudgeSubmit(team, judge.name, e.target.value)}
                      defaultValue=""
                    >
                      <option value="" disabled>
                        Select Score
                      </option>
                      {[1, 2, 3, 4, 5].map((score) => (
                        <option key={score} value={score}>
                          {score}
                        </option>
                      ))}
                    </select>
                  </div>
                ))}
              </div>
            ))}
          </div>

          {/* Audience Voting */}
          <div className="mb-6">
            <h2 className="text-xl font-semibold mb-2">Audience Voting</h2>
            {teams.map((team) => (
              <div key={team} className="flex items-center mb-2">
                <label className="w-32">{team}:</label>
                <select
                  className="border rounded p-1"
                  onChange={(e) => handleAudienceSubmit(team, e.target.value)}
                  defaultValue=""
                >
                  <option value="" disabled>
                    Select Vote
                  </option>
                  {[1, 2, 3, 4, 5].map((vote) => (
                    <option key={vote} value={vote}>
                      {vote}
                    </option>
                  ))}
                </select>
              </div>
            ))}
          </div>

          {/* Results */}
          <div>
            <h2 className="text-xl font-semibold mb-2">Results</h2>
            <div className="bg-white p-4 rounded shadow">
              {teams.map((team) => (
                <div key={team} className="flex justify-between mb-2">
                  <span>{team}</span>
                  <span>Score: {calculateTeamScore(team)}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>